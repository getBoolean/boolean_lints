name: CI
on:
  push:
    branches:
      - main
      - release
      - feature/*
      - template
  pull_request:
    branches:
      - main
      - release
      - feature/*
      - template


jobs:
  test:
    name: Run dart analyze and custom_lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
      - name: Install and set Flutter version
        uses: subosito/flutter-action@v2
        with:
          channel: "stable"
          architecture: x64
      
      - name: Get Packages
        run: |
          dart pub get
          cd example/random
          dart pub get
          cd ../..
          cd example/banned_code/id_class_package
          dart pub get
          cd ../../..

      - name: Verify Formatting
        run: dart format --set-exit-if-changed .

      - name: Run Dart Analyze
        run: dart analyze --fatal-warnings
      
      - name: Run Tests
        run: dart test

      - name: Run Custom Lints
        run: cd example && dart run custom_lint
